version: "3.9"            # <â€” good practice with Coolify
name: webtop-os

services:
  webtop:
    build:
      context: .
      dockerfile: Dockerfile.custom

    # 1ï¸âƒ£  Let Coolify/Traefik â€œseeâ€ the port
    ports:
      - "3000"             # host part omitted â‡’ container still listens on 3000

    security_opt:
      - seccomp:unconfined

    environment:
      # ðŸ‘‰ static settings
      PUID: 1000
      PGID: 1000
      TZ: America/New_York
      SUBFOLDER: /
      TITLE: Webtop

      # ðŸ‘‰ credentials Coolify will pre-seed in the UI
      CUSTOM_USER: ${SERVICE_USER_WEBTOP}
      SUDO_PASSWORD: ${SERVICE_PASSWORD_WEBTOP}
      PASSWORD: ${SERVICE_PASSWORD_WEBTOP}

      # 2ï¸âƒ£  ask Coolify to generate a public URL & proxy
      SERVICE_FQDN_WEBTOP          # becomes e.g. http://webtop-abcd.example.com:3000

      # (optional) reuse that same value in another var your app reads
      BASE_URL: $SERVICE_FQDN_WEBTOP

      # ðŸ‘‰ your extra LinuxServer mods & packages
      DOCKER_MODS: linuxserver/mods:universal-package-install|linuxserver/mods:code-server-zsh
      INSTALL_PACKAGES: unzip|chromium|nano|neovim|git|htop|curl|wget|ripgrep|fonts-lyx|xclip|xsel|gcc|clang|build-essential|libgtk-4-1|libgraphene-1.0-0|libxslt1.1|libwoff1|libevent-2.1-7|libgstreamer-gl1.0-0|libgstreamer-plugins-bad1.0-0|libharfbuzz-icu0|libsecret-1-0|libhyphen0|libmanette-0.2-0|libgles2|x11-xserver-utils|xorg|x11-common|x11-utils

    volumes:
      - ./webtop-config:/config:rw
    devices:
      - /dev/dri:/dev/dri
    shm_size: "4gb"
    restart: unless-stopped
    privileged: true
